<ion-content [fullscreen]="true">

        <!-- Sidebar -->
        <div class="menu-dashboard" id="sidebar">
          <div class="top-menu">
            <div class="logo">
              <!-- Aquí se agrega el logo -->
              <img src="assets/images/logo.png" alt="Logo de Junta Vecinal" class="logo-img">
            </div>
          </div>

        <!-- Menú -->
        <div class="menu">

          <div class="enlace" (click)="irAInicio()">
            <ion-icon name="home" size="small"></ion-icon>
            <span>Inicio</span>
          </div>

          <div class="enlace" (click)="irAQuejas()">
            <ion-icon name="chatbubbles" size="small"></ion-icon>
            <span>Quejas</span>
          </div>

          <div class="enlace" (click)="irAEventos()">
            <ion-icon name="calendar" size="small"></ion-icon>
            <span>Eventos</span>
          </div>

          <div class="enlace" (click)="irANoticias()">
            <ion-icon name="newspaper" size="small"></ion-icon>
            <span>Noticias</span>
          </div>

          <div class="enlace" (click)="irAReportarSituacion()">
            <ion-icon name="alert-circle" size="small"></ion-icon>
            <span>Reportes</span>
          </div>

          <div class="enlace" (click)="irAGestionUsuarios()">
            <ion-icon name="people" size="small"></ion-icon>
            <span>Usuarios</span>
          </div>

          <div class="enlace" (click)="irALocales()">
            <ion-icon name="storefront" size="small"></ion-icon> <!-- Icono para Locales -->
            <span>Locales</span>
          </div>

          <div class="enlace" (click)="volverAlLogin()">
            <ion-icon name="log-out" size="small"></ion-icon>
            <span>Cerrar Sesión</span>
          </div>
        </div>
      </div>


<div class="content" style="background-image: url('assets/images/fondo2.png'); background-size: cover; background-repeat: no-repeat; background-position: center; height: 100vh;">

  <ion-card-header>
    <ion-card-title style="display: flex; align-items: center; font-size: xx-large; color: #4a4e69; font-weight: bold;">
      <ion-icon name="alert-circle" style="font-size: 1.6em; color: #6d5dfc; margin-right: 10px;"></ion-icon>
      Reportes

      <ion-button
        (click)="abrirFormulario()"
        size="small"
        fill="clear"
        style="margin-left: auto; font-size: 1em; padding: 0.2em 0.5em; height: auto; width: auto;">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>

    </ion-card-title>
  </ion-card-header>

  <!-- Barra de búsqueda -->
  <div class="search-bar">
    <ion-searchbar [(ngModel)]="searchTerm" placeholder="Buscar reportes..." (ionInput)="filtrarReportes()" class="search-input"></ion-searchbar>
    <button class="search-button" (click)="filtrarReportes()">Buscar</button>
  </div>

<!-- Listado de Reportes en formato de ticket -->
<ion-grid style="margin: auto;">
  <ion-row>
    <ion-col size="6" *ngFor="let reporte of reportesFiltrados">
      <div class="reportes-container">
        <ion-card class="card-reporte">
          <ion-card-header>
            <div class="categoria-container" [ngStyle]="{ 'background-color': getColorForCategory(reporte.categoria) }">
              <ion-chip class="categoria-chip">
                <ion-icon [name]="getIconForCategory(reporte.categoria)" color="white"></ion-icon>
                <ion-label class="categoria-label">{{ reporte.categoria || 'Ninguna' }}</ion-label>
              </ion-chip>
            </div>
          </ion-card-header>

          <ion-card-content>
            <div class="image-container">
              <img *ngIf="reporte.imagenUrl" [src]="reporte.imagenUrl" alt="Imagen del Reporte" class="recortada-imagen" />
            </div>
            <ion-card-title style="color: black; font-weight: bold; text-align: center; padding: 10px;">{{ reporte.direccion }}</ion-card-title>
            <p class="content-background">Descripción: {{ reporte.descripcion }}</p>
          </ion-card-content>

          <ion-footer style="display: flex; justify-content: flex-end; padding: 8px;">
            <ion-button (click)="verDetalleReporte(reporte)" fill="clear" size="big">
              <ion-icon name="information-circle" slot="icon-only" color="medium" style="font-size: 32px;"></ion-icon>
            </ion-button>
            <ion-button (click)="editarReporte(reporte)" fill="clear" size="big" color="primary">
              <ion-icon name="create" slot="icon-only" color="primary" style="font-size: 32px;"></ion-icon>
            </ion-button>
            <ion-button (click)="eliminarReporte(reporte)" fill="clear" size="big" color="danger">
              <ion-icon name="trash" slot="icon-only" color="danger" style="font-size: 32px;"></ion-icon>
            </ion-button>
          </ion-footer>
        </ion-card>
      </div>
    </ion-col>
  </ion-row>
</ion-grid>

  <ion-text color="medium" *ngIf="reportes.length === 0">
    <p>No hay reportes registrados.</p>
  </ion-text>

  <!-- Modal para visualizar detalles del reporte -->
  <ion-modal [isOpen]="modalDetalleAbierto" (ionModalDidDismiss)="cerrarDetalle()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Detalles del Reporte</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarDetalle()" fill="clear">
              <ion-icon name="close" color="dark"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-content">
        <ion-card>
          <ion-card-header>
            <ion-card-title style="color: black;">{{ reporteSeleccionado.direccion }}</ion-card-title>
            <div class="categoria-container" [ngStyle]="{ 'background-color': getColorForCategory(reporteSeleccionado.categoria) }">
              <ion-chip class="categoria-chip">
                <ion-icon [name]="getIconForCategory(reporteSeleccionado.categoria)" color="white"></ion-icon>
                <ion-label class="categoria-label">{{ reporteSeleccionado.categoria || 'Ninguna' }}</ion-label>
              </ion-chip>
            </div>
          </ion-card-header>

          <ion-card-content>
            <p>{{ reporteSeleccionado.descripcion }}</p>
            <img *ngIf="reporteSeleccionado.imagenUrl" [src]="reporteSeleccionado.imagenUrl" alt="Imagen del reporte" style="width: 100%; height: auto;" />
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Modal para agregar/editar reporte -->
  <ion-modal [isOpen]="modalAbierto" (ionModalDidDismiss)="cerrarFormulario()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ isEditMode ? 'Editar Reporte' : 'Agregar Reporte' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarFormulario()" fill="clear">
              <ion-icon name="close" color="dark"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-content">
        <div class="report-header">
          <ion-icon name="warning" class="report-icon"></ion-icon>
          <h2>{{ isEditMode ? 'Editar Reporte' : '¿Desea reportar una situación vecino?' }}</h2>
        </div>

        <ion-card class="form-card">
          <ion-card-content>
            <form (ngSubmit)="registrarReporte()" #reporteForm="ngForm">
              <ion-item>
                <ion-label position="floating">Dirección</ion-label>
                <ion-input [(ngModel)]="nuevoReporte.direccion" name="direccion" required></ion-input>
              </ion-item>
              <ion-text color="danger" *ngIf="reporteForm.submitted && !nuevoReporte.direccion">
                Dirección es obligatoria.
              </ion-text>

              <ion-item>
                <ion-label position="floating">Descripción</ion-label>
                <ion-textarea [(ngModel)]="nuevoReporte.descripcion" name="descripcion" required></ion-textarea>
              </ion-item>
              <ion-text color="danger" *ngIf="reporteForm.submitted && !nuevoReporte.descripcion">
                Descripción es obligatoria.
              </ion-text>

              <ion-item>
                <ion-label>Categoría</ion-label>
                <ion-select [(ngModel)]="nuevoReporte.categoria" name="categoria" required>
                  <ion-select-option *ngFor="let categoria of categorias" [value]="categoria">{{ categoria }}</ion-select-option>
                </ion-select>
              </ion-item>
              <ion-text color="danger" *ngIf="reporteForm.submitted && !nuevoReporte.categoria">
                Categoría es obligatoria.
              </ion-text>

              <ion-item>
                <ion-label>Imagen (opcional)</ion-label>
                <ion-input type="file" (change)="onFileSelected($event)"></ion-input>
              </ion-item>

              <ion-button type="submit" expand="full" class="submit-button" shape="round">
                {{ isEditMode ? 'Actualizar' : 'Reportar' }}
              </ion-button>
            </form>
            <div class="emergency-footer">
              <div class="emergency-card">
                <ion-icon name="medical-outline"></ion-icon>
                <span class="emergency-text">131</span>
                <span style="color: black;">Ambulancia</span>
              </div>
              <div class="emergency-card">
                <ion-icon name="flame-outline"></ion-icon>
                <span class="emergency-text">132</span>
                <span style="color: black;">Bomberos</span>
              </div>
              <div class="emergency-card">
                <ion-icon name="shield-outline"></ion-icon>
                <span class="emergency-text">(2)2922 3130</span>
                <span style="color: black;">P.Cuadrante</span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
 </div>
</ion-content>
